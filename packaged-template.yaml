AWSTemplateFormatVersion: '2010-09-09'
Description: AWS CloudFormation Template to create a VPC with subnets, route tables,
  and an internet gateway.
Resources:
  VPCNestedStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: https://s3.us-east-1.amazonaws.com/cyjava2006/0a1a921e195455f8f7a8b4ca47d2f08f.template
      Parameters:
        VpcCidr: 10.0.0.0/16
        InstanceTenancy: default
  SubnetNestedStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: https://s3.us-east-1.amazonaws.com/cyjava2006/924b58c8a9297cb4b4a91da2f11120e4.template
      Parameters:
        MySubnet1Cidr: 10.0.0.0/24
        MySubnet2Cidr: 10.0.1.0/24
        SubnetAZ:
          Fn::Select:
          - 0
          - Fn::GetAZs: ''
        VpcId:
          Fn::GetAtt:
          - VPCNestedStack
          - Outputs.VpcId
    DependsOn:
    - VPCNestedStack
  InternetGatewayNestedStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: https://s3.us-east-1.amazonaws.com/cyjava2006/00d6328ac8a9307f41efbf5889e08fde.template
      Parameters:
        VpcId:
          Fn::GetAtt:
          - VPCNestedStack
          - Outputs.VpcId
    DependsOn:
    - VPCNestedStack
  PublicRouteTableNestedStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: https://s3.us-east-1.amazonaws.com/cyjava2006/de1aaa832d0bd7dd9146a15bdd5eb3af.template
      Parameters:
        DestinationCidrBlock: 10.0.0.0/24
        SubnetId:
          Fn::GetAtt:
          - SubnetNestedStack
          - Outputs.MySubnet1Id
        VpcId:
          Fn::GetAtt:
          - VPCNestedStack
          - Outputs.VpcId
        GatewayId:
          Fn::GetAtt:
          - InternetGatewayNestedStack
          - Outputs.MyInternetGatewayId
    DependsOn:
    - SubnetNestedStack
    - InternetGatewayNestedStack
  PrivateRouteTableNestedStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: https://s3.us-east-1.amazonaws.com/cyjava2006/9634e8aa2913a2eba4d164b6267730fb.template
      Parameters:
        DestinationCidrBlock: 10.0.1.0/24
        SubnetId:
          Fn::GetAtt:
          - SubnetNestedStack
          - Outputs.MySubnet2Id
        VpcId:
          Fn::GetAtt:
          - VPCNestedStack
          - Outputs.VpcId
    DependsOn:
    - SubnetNestedStack
  SecurityGroupNestedStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: https://s3.us-east-1.amazonaws.com/cyjava2006/6b87ecc2e7460a7d6003eb0252aeeaab.template
      Parameters:
        VpcId:
          Fn::GetAtt:
          - VPCNestedStack
          - Outputs.VpcId
    DependsOn:
    - VPCNestedStack
Outputs:
  VpcId:
    Description: The ID of the created VPC
    Value:
      Fn::GetAtt:
      - VPCNestedStack
      - Outputs.VpcId
    Export:
      Name: NetworkStack-VpcId
  PublicSubnetId:
    Description: The ID of the created Public Subnet
    Value:
      Fn::GetAtt:
      - SubnetNestedStack
      - Outputs.MySubnet1Id
    Export:
      Name: NetworkStack-PublicSubnetId
  PrivateSubnetId:
    Description: The ID of the created Private Subnet
    Value:
      Fn::GetAtt:
      - SubnetNestedStack
      - Outputs.MySubnet2Id
    Export:
      Name: NetworkStack-PrivateSubnetId
  InternetGatewayId:
    Description: The ID of the created Internet Gateway
    Value:
      Fn::GetAtt:
      - InternetGatewayNestedStack
      - Outputs.MyInternetGatewayId
    Export:
      Name: NetworkStack-InternetGatewayId
  PublicRouteTableId:
    Description: The ID of the created Public Route Table
    Value:
      Fn::GetAtt:
      - PublicRouteTableNestedStack
      - Outputs.MyRouteTableId
    Export:
      Name: NetworkStack-PublicRouteTableId
  PrivateRouteTableId:
    Description: The ID of the created Private Route Table
    Value:
      Fn::GetAtt:
      - PrivateRouteTableNestedStack
      - Outputs.PrivateRouteTableId
    Export:
      Name: NetworkStack-PrivateRouteTableId
  SecurityGroupId:
    Description: The ID of the created Security Group
    Value:
      Fn::GetAtt:
      - SecurityGroupNestedStack
      - Outputs.MySecurityGroupId
    Export:
      Name: NetworkStack-MySecurityGroupId
